#!/bin/sh

# Output: [icon 55Â°C]

# icons: ï‹‹ ï‹Š ï‹‰ ï‹ˆ ï‹‡ î§¶
prog=$(basename "$0")
icon="î"
units="Â°C"
target="temp1"
warn_icon="ğŸ”¥"
warning=80

sensors_str=$(sensors | grep "$target" | awk '{print $2}' | sed 's/+//')
sensors_int=${sensors_str%.*}

notify() {
	msg="$1"
	urgency="$2"
	export DISPLAY=":0"
	dunstify -h string:x-dunst-stack-tag:temppercore -i "cpu" -u "$urgency" "$prog" "$msg"
}

dwm_sensors() {
	if [ "$sensors_int" -ge "$warning" ]; then
		icon="$warn_icon"
		notify "$icon$sensors_int$units is too high" "critical"
	fi

	printf "%s" "$SEP1"
	printf "%s %s%s" "$icon" "$sensors_int" "$units"
	printf "%s" "$SEP2"
}

dwm_sensors_color() {
	red_color="^c#fb4934^"
	mid_color="^c#e78a4e^"
	reset_color="^d^"

	printf "%s" "$SEP1"
	if [ "$sensors_int" -gt 70 ] && [ "$sensors_int" -le 79 ]; then
		printf "%s%s%s %s%s" "$mid_color" "$icon" "$reset_color" "$sensors_int" "$units"
	elif [ "$sensors_int" -ge 80 ]; then
		printf "%s%s %s%s%s" "$red_color" "$icon" "$sensors_int" "$units" "$reset_color"
	else
		printf "%s %s%s" "$icon" "$sensors_int" "$units"
	fi
	printf "%s" "$SEP2"
}

if [ "$DWM_COLOR" = true ]; then
	dwm_sensors_color
else
	dwm_sensors
fi
